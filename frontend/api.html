<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API 文檔 - AI 換臉應用</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif; line-height: 1.6; color: #333; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px 0; text-align: center; margin-bottom: 30px; border-radius: 10px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .nav-links { text-align: center; margin-bottom: 30px; }
        .nav-links a { display: inline-block; margin: 0 10px; padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; transition: background 0.3s; }
        .nav-links a:hover { background: #5a6fd8; }
        .api-section { background: white; margin-bottom: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; }
        .section-header { background: #f8f9fa; padding: 20px; border-bottom: 1px solid #e9ecef; }
        .section-header h2 { color: #333; margin-bottom: 10px; }
        .section-content { padding: 20px; }
        .api-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .api-table th, .api-table td { padding: 12px; text-align: left; border-bottom: 1px solid #e9ecef; }
        .api-table th { background: #f8f9fa; font-weight: 600; color: #495057; }
        .method { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.9em; }
        .method.get { background: #d4edda; color: #155724; }
        .method.post { background: #d1ecf1; color: #0c5460; }
        .method.delete { background: #f8d7da; color: #721c24; }
        .endpoint { font-family: 'Courier New', monospace; background: #e9ecef; padding: 2px 6px; border-radius: 3px; }
        .code-block { background: #2d2d2d; color: #f8f8f2; border-radius: 5px; padding: 15px; margin: 15px 0; overflow-x: auto; }
        .code-block pre { margin: 0; font-family: 'Courier New', monospace; font-size: 0.9em; }
        .parameter-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .parameter-table th, .parameter-table td { padding: 8px 12px; border: 1px solid #e9ecef; text-align: left; }
        .parameter-table th { background: #f8f9fa; }
        .required { color: #dc3545; font-weight: bold; }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2em; }
            .nav-links a { display: block; margin: 5px 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 AI 換臉應用 API 文檔</h1>
            <p>基於 FastAPI 的 RESTful API 服務</p>
        </div>

        <div class="nav-links">
            <a href="/api/docs" target="_blank">⚡ Swagger UI</a>
            <a href="/api/system/info" target="_blank">💚 系統狀態</a>
        </div>

        <!-- 核心 API -->
        <div class="api-section">
            <div class="section-header">
                <h2>核心 API</h2>
            </div>
            <div class="section-content">
                <!-- 同步換臉 -->
                <h3><span class="method post">POST</span> <code class="endpoint">/api/swapper</code></h3>
                <p><strong>同步換臉</strong>: 即時處理換臉請求並直接返回結果，適合需要快速回應的場景。</p>
                <h4>參數 (multipart/form-data):</h4>
                <table class="parameter-table">
                    <thead><tr><th>參數名</th><th>類型</th><th>必須</th><th>描述</th></tr></thead>
                    <tbody>
                        <tr><td><code>file</code></td><td>File</td><td><span class="required">是</span></td><td>使用者上傳的原始照片。</td></tr>
                        <tr><td><code>template_id</code></td><td>String</td><td>否</td><td>預設模板 ID。與 `template_file` 二選一。</td></tr>
                        <tr><td><code>template_file</code></td><td>File</td><td>否</td><td>使用者自訂的模板圖片。與 `template_id` 二選一。</td></tr>
                        <tr><td><code>source_face_index</code></td><td>Integer</td><td>否</td><td>原始照片中的臉部索引 (預設 0)。</td></tr>
                        <tr><td><code>target_face_index</code></td><td>Integer</td><td>否</td><td>模板圖片中的臉部索引 (預設 0)。</td></tr>
                    </tbody>
                </table>
                <h4>成功回應 (200 OK):</h4>
                <div class="code-block"><pre><code>{
  "success": true,
  "result_url": "/results/result_xxxxxxxx.jpg",
  "original_url": "/uploads/original_xxxxxxxx.jpg",
  "processing_time": "1.23s",
  "message": "換臉處理完成"
}</code></pre></div>

                <!-- 非同步換臉 -->
                <hr style="margin: 20px 0;">
                <h3><span class="method post">POST</span> <code class="endpoint">/api/face-swap</code></h3>
                <p><strong>非同步換臉</strong>: 將換臉請求提交至背景佇列處理，立即返回任務 ID。</p>
                <h4>參數: (同上)</h4>
                <h4>成功回應 (200 OK):</h4>
                <div class="code-block"><pre><code>{
  "success": true,
  "task_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "status": "pending",
  "message": "任務已提交，請使用任務 ID 查詢處理狀態"
}</code></pre></div>

                <!-- 查詢任務狀態 -->
                <hr style="margin: 20px 0;">
                <h3><span class="method get">GET</span> <code class="endpoint">/api/face-swap/status/{task_id}</code></h3>
                <p><strong>查詢任務狀態</strong>: 根據任務 ID 查詢非同步任務的處理進度。</p>
                <h4>成功回應 (200 OK):</h4>
                <div class="code-block"><pre><code>{
  "success": true,
  "task_status": {
    "task_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "status": "completed",
    "progress": 100,
    "message": "換臉處理完成",
    "result_url": "/results/result_yyyyyyyy.jpg",
    "original_url": "/uploads/original_yyyyyyyy.jpg",
    "created_at": "2025-08-18T12:00:00Z",
    "completed_at": "2025-08-18T12:01:30Z"
  }
}</code></pre></div>
            </div>
        </div>

        <!-- 輔助 API -->
        <div class="api-section">
            <div class="section-header">
                <h2>輔助 API</h2>
            </div>
            <div class="section-content">
                <!-- 驗證圖片 -->
                <h3><span class="method post">POST</span> <code class="endpoint">/api/validate-image</code></h3>
                <p><strong>驗證圖片</strong>: 回傳圖片是否有效及偵測到的臉部資訊。</p>
                <h4>成功回應 (200 OK):</h4>
                <div class="code-block"><pre><code>{
  "success": true,
  "message": "圖片驗證成功",
  "image_info": {
    "valid": true,
    "face_count": 2,
    "faces": [{"box": [x1, y1, x2, y2], "confidence": 0.99}]
  }
}</code></pre></div>

                <!-- 獲取結果圖片 -->
                <hr style="margin: 20px 0;">
                <h3><span class="method get">GET</span> <code class="endpoint">/api/results/{filename}</code></h3>
                <p><strong>獲取結果圖片</strong>: 根據檔名獲取已處理完成的結果圖片。</p>
                
                <!-- 獲取原始圖片 -->
                <hr style="margin: 20px 0;">
                <h3><span class="method get">GET</span> <code class="endpoint">/api/uploads/{filename}</code></h3>
                <p><strong>獲取原始圖片</strong>: 根據檔名獲取用戶上傳的原始圖片。</p>
                
                <!-- 刪除結果圖片 -->
                <hr style="margin: 20px 0;">
                <h3><span class="method delete">DELETE</span> <code class="endpoint">/api/results/{filename}</code></h3>
                <p><strong>刪除結果圖片</strong>: 刪除指定的結果圖片檔案。</p>
                
                <!-- 刪除原始圖片 -->
                <hr style="margin: 20px 0;">
                <h3><span class="method delete">DELETE</span> <code class="endpoint">/api/uploads/{filename}</code></h3>
                <p><strong>刪除原始圖片</strong>: 刪除指定的原始圖片檔案。</p>
            </div>
        </div>

        <!-- 系統 API -->
        <div class="api-section">
            <div class="section-header">
                <h2>系統 & 監控 API</h2>
            </div>
            <div class="section-content">
                <!-- 系統資訊 -->
                <h3><span class="method get">GET</span> <code class="endpoint">/api/system/info</code></h3>
                <p><strong>系統資訊</strong>: 查詢後端系統狀態，包括 CPU/記憶體及 GPU 使用模式。</p>
                <h4>成功回應 (200 OK):</h4>
                <div class="code-block"><pre><code>{
  "success": true,
  "system_info": {
      "cpu_percent": 15.5,
      "memory_percent": 45.2,
      "gpu_info": { "gpu_name": "NVIDIA GeForce RTX 3080", ... }
  },
  "processor_gpu_enabled": true,
  "message": "目前使用GPU模式進行處理"
}</code></pre></div>

                <!-- 佇列狀態 -->
                <hr style="margin: 20px 0;">
                <h3><span class="method get">GET</span> <code class="endpoint">/api/queue/status</code></h3>
                <p><strong>佇列狀態</strong>: 查詢當前伺服器的任務處理佇列狀態。</p>
                <h4>成功回應 (200 OK):</h4>
                <div class="code-block"><pre><code>{
  "success": true,
  "queue_status": { "current_queue_size": 0, "max_queue_size": 5 },
  "task_statistics": { "pending": 0, "processing": 0, "completed": 120, ... }
}</code></pre></div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px; color: #6c757d;">
            <p>© 2025 AI 換臉應用 - 僅供學習和研究使用</p>
        </div>
    </div>
</body>
</html>